server {
    listen 80 default_server;
    server_name _;

    modsecurity on;
    modsecurity_rules_file /etc/nginx/modsecurity.conf;

    location / {
        return 200 'Hello from Secured Nginx!';
    }

    location /admin {
        content_by_lua_block {
            local auth = ngx.var.http_authorization
            if not auth or auth ~= "Basic " .. ngx.encode_base64("admin:password") then
                ngx.header["WWW-Authenticate"] = 'Basic realm="Restricted"'
                ngx.exit(ngx.HTTP_UNAUTHORIZED)
            end
            ngx.say("Access granted!")
        }
    }
}